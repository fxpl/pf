\documentclass{article}

\usepackage{ifthen}

\newenvironment{pfproof}{}{}

%% Code for handling cases

% We have counters for tracking the current nesting depth of
% cases, as well as the current case at each level.
%
% TODO: Check \counterwithin for linking the case counters and
% resetting them automatically
\newcounter{pfcasedepth}
\newcounter{pfcasecounter}
\newcounter{pfsubcasecounter}
\newcounter{pfsubsubcasecounter}
% etc.

% Entering a new set of cases increases depth and resets the case
% counter of that depth.
\newenvironment{pfcases}
  {
    \stepcounter{pfcasedepth}
    \begin{enumerate}
  }
  {
    \ifthenelse{\thepfcasedepth = 1}{
      \setcounter{pfcasecounter}{0}
    }{
    \ifthenelse{\thepfcasedepth = 2}{
      \setcounter{pfsubcasecounter}{0}
    }{
    \ifthenelse{\thepfcasedepth = 3}{
      \setcounter{pfsubsubcasecounter}{0}
    }{
      % etc.
    }}}
    \addtocounter{pfcasedepth}{-1}
    \end{enumerate}
  }

% Creating a new case increases the case counter of the current depth
\newcommand{\pfcase}[1]{%
\ifthenelse{\thepfcasedepth = 1}
{\stepcounter{pfcasecounter}\item[{\bf Case}~\thepfcasecounter] #1}
{\ifthenelse{\thepfcasedepth = 2}
  {\stepcounter{pfsubcasecounter}\item[{\bf Case}~\thepfcasecounter.\thepfsubcasecounter] #1}
  {\ifthenelse{\thepfcasedepth = 3}
    {\stepcounter{pfsubsubcasecounter}\item[{\bf Case}~\thepfcasecounter.\thepfsubcasecounter.\thepfsubsubcasecounter] #1}
    {\item}}}}


%% Code for dealing with labels and cross-referencing

% The prefix added to labels and references at the current level
\newcommand{\pfprefix}{pf}
% The text produced by \pfref
\newcommand{\pfposition}{1}

% The \pfcalculate macro sets the correct values of \pfprefix and
% \pfposition based on where it is invoked
%
% TODO: Should have current proof as well
\newcommand{\pfcalculate}{%
\ifthenelse{\thepfcasedepth = 1}
{\renewcommand\pfprefix{pf}%
\renewcommand\pfposition{\thepfcasecounter}}
{\ifthenelse{\thepfcasedepth = 2}
  {\renewcommand\pfprefix{pf:\thepfcasecounter}%
   \renewcommand\pfposition{\thepfcasecounter.\thepfsubcasecounter}}
  {\ifthenelse{\thepfcasedepth = 3}
    {\renewcommand\pfprefix{pf:\thepfcasecounter:\thepfsubcasecounter}%
     \renewcommand\pfposition{\thepfcasecounter.\thepfsubcasecounter.\thepfsubsubcasecounter}}
    {\renewcommand\pfprefix{pf:\thepfcasecounter:\thepfsubcasecounter:\thepfsubsubcasecounter}%
     \renewcommand\pfposition{\thepfcasecounter.\thepfsubcasecounter.\thepfsubsubcasecounter.MAX}}}}%
}

% The macro \pflabelas works like label, but also allows setting
% the string associated with the label.
\makeatletter
\newcommand\pflabelas[2]{%
  \def\@currentlabel{#2}%
  \label{#1}}
\makeatother

% Create a label prefixed with the current position in the proof
\newcommand{\pflabel}[1]{\pfcalculate\pflabelas{\pfprefix:#1}{\pfposition}}

% Reference a label prefixed with the current position in the proof
\newcommand{\pfref}[1]{\pfcalculate\ref{\pfprefix:#1}}

\begin{document}

%\section{Using \texttt{pfcases}}

%\begin{pftheorem}{Progress}
  % \begin{pfstatement}

  % \end{pfstatement}

  % \begin{pfsketch}

  % \end{pfsketch}

\begin{pfcases}
  \pfcase{Foo}\pflabel{foo}\\
  We proceed by cases:
  \begin{pfcases}
    \pfcase{Also Foo}\pflabel{foo}\\
    Trivial

    \pfcase{Bar}\pflabel{bar}\\
    Case~\pfref{bar} is the same as Case~\pfref{foo}. We proceed by cases:
  \end{pfcases}

  \pfcase{Also Bar}\pflabel{bar}\\
  Case~\pfref{bar} is the same as Case~\pfref{foo}
\end{pfcases}

\end{document}
